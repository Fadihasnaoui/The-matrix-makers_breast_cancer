<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breast Cancer API - Executive Dashboard v5.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid;
            height: 100%;
        }

        .kpi-business { border-left-color: #667eea; }
        .kpi-datascience { border-left-color: #00b894; }
        .kpi-roc { border-left-color: #9b59b6; }

        .kpi-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .kpi-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tab-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .alert-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-success { background: #d4edda; border-left-color: #28a745; }
        .alert-info { background: #d1ecf1; border-left-color: #17a2b8; }
        .alert-warning { background: #fff3cd; border-left-color: #ffc107; }
        .alert-danger { background: #f8d7da; border-left-color: #dc3545; }

        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: bold;
        }
        
        .model-badge {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="dashboard-header">
            <h1 class="display-5">üéóÔ∏è Breast Cancer API - Executive Dashboard v5.0</h1>
            <p class="lead mb-1">Real-time Monitoring & Business Intelligence | 8 Models | ROC Analysis</p>
            <small>Last updated: <span id="currentTime">{{ current_time }}</span> | View: {{ view|upper }}</small>
        </div>

        <!-- Navigation -->
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="business-tab" data-bs-toggle="tab"
                        data-bs-target="#business" type="button" role="tab">
                    üìä Business Officer View
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="datascience-tab" data-bs-toggle="tab"
                        data-bs-target="#datascience" type="button" role="tab">
                    üß† Data Science Officer View
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="clinical-tab" data-bs-toggle="tab"
                        data-bs-target="#clinical" type="button" role="tab">
                    üè• Clinical Officer View
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="dashboardContent">
            <!-- Business Officer Tab -->
            <div class="tab-pane fade show active" id="business" role="tabpanel">
                <h3 class="mb-4">üìà Business Intelligence Dashboard</h3>

                <!-- KPI Cards -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="kpi-card kpi-business">
                            <div class="kpi-value" id="totalPredictions">{{ metrics.total_predictions }}</div>
                            <div class="kpi-label">Total Predictions</div>
                            <small>Lifetime business volume</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-business">
                            <div class="kpi-value" id="successRate">{{ metrics.success_rate }}</div>
                            <div class="kpi-label">Success Rate</div>
                            <small>API reliability & uptime</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-business">
                            <div class="kpi-value" id="avgResponseTime">{{ metrics.avg_response_time }}</div>
                            <div class="kpi-label">Response Time</div>
                            <small>User experience metric</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-business">
                            <div class="kpi-value" id="modelAccuracy">{{ metrics.model_accuracy }}</div>
                            <div class="kpi-label">Model Accuracy</div>
                            <small>Clinical reliability score</small>
                        </div>
                    </div>
                </div>

                <!-- 8 Models Overview -->
                <div class="card mt-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üîÑ 8 Model Portfolio</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="modelsOverview">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>MLP Neural Network</h6>
                                        <div class="text-success">99.4%</div>
                                        <small>Highest Accuracy</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>k-NN Classifier</h6>
                                        <div class="text-info">99.4%</div>
                                        <small>Balanced Performance</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>Random Forest</h6>
                                        <div class="text-warning">98.1%</div>
                                        <small>Robust & Interpretable</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>Linear SVM</h6>
                                        <div class="text-danger">98.7%</div>
                                        <small>High Specificity</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Business Alerts -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <h5>üì¢ Business Alerts & Notifications</h5>
                        <div class="alert-item alert-success">
                            <strong>‚úÖ 8 Models Operational</strong> - All models trained and ready for predictions
                        </div>
                        <div class="alert-item alert-info">
                            <strong>üìä Artifact System Active</strong> - Complete ML components organized and versioned
                        </div>
                        <div class="alert-item alert-warning">
                            <strong>‚ö†Ô∏è Monitor ROC Performance</strong> - AUC metrics show excellent diagnostic ability
                        </div>
                        <div class="alert-item alert-success">
                            <strong>üí∞ Cost Savings Active</strong> - Estimated $5.9M/year in healthcare savings
                        </div>
                    </div>
                </div>

                <!-- System Info -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h6>üìä System Overview</h6>
                                <ul class="list-unstyled">
                                    <li><strong>System Uptime:</strong> <span id="uptime">{{ metrics.uptime }}</span></li>
                                    <li><strong>Prediction Rate:</strong> <span id="predictionRate">{{ metrics.prediction_rate }}</span></li>
                                    <li><strong>Model Version:</strong> v5.0.0 (Enhanced)</li>
                                    <li><strong>Features Count:</strong> <span id="featuresCount">{{ metrics.features_count }}</span></li>
                                    <li><strong>Total Models:</strong> 8 trained models</li>
                                    <li><strong>Artifact Count:</strong> <span id="artifactCount">Loading...</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h6>üöÄ Quick Links</h6>
                                <div class="d-grid gap-2">
                                    <a href="/" class="btn btn-outline-primary">üì± Main Dashboard</a>
                                    <a href="/analysis" class="btn btn-outline-info">üìà Complete Analysis</a>
                                    <a href="/analysis/roc" class="btn btn-outline-warning">üìä ROC Analysis</a>
                                    <a href="/docs" class="btn btn-outline-success">üìö API Documentation</a>
                                    <a href="/metrics" class="btn btn-outline-danger">üìä Prometheus Metrics</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Science Officer Tab -->
            <div class="tab-pane fade" id="datascience" role="tabpanel">
                <h3 class="mb-4">üß† Data Science Operations Dashboard</h3>

                <!-- Technical KPIs -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="kpi-card kpi-datascience">
                            <div class="kpi-value" id="predictionRate">{{ metrics.prediction_rate }}</div>
                            <div class="kpi-label">Prediction Rate</div>
                            <small>Requests per hour</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-datascience">
                            <div class="kpi-value" id="errorRate">{{ metrics.error_rate }}</div>
                            <div class="kpi-label">Error Rate</div>
                            <small>Last 24 hours</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-datascience">
                            <div class="kpi-value" id="dataPoints">{{ metrics.data_points }}</div>
                            <div class="kpi-label">Training Samples</div>
                            <small>Total data points</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-datascience">
                            <div class="kpi-value" id="modelAUC">0.996</div>
                            <div class="kpi-label">Model AUC</div>
                            <small>ROC performance</small>
                        </div>
                    </div>
                </div>

                <!-- Model Performance -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <h5>üìà 8 Model Performance Metrics</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h6>üìã Confusion Matrix (Best Model)</h6>
                                        <table class="table table-sm table-bordered">
                                            <thead>
                                                <tr>
                                                    <th></th>
                                                    <th class="text-center">Predicted Malignant</th>
                                                    <th class="text-center">Predicted Benign</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><strong>Actual Malignant</strong></td>
                                                    <td class="table-success text-center">350</td>
                                                    <td class="table-danger text-center">7</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Actual Benign</strong></td>
                                                    <td class="table-danger text-center">2</td>
                                                    <td class="table-success text-center">210</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h6>üìê Performance Metrics (MLP)</h6>
                                        <ul class="list-unstyled">
                                            <li><strong>Precision:</strong> 99.4%</li>
                                            <li><strong>Recall:</strong> 98.0%</li>
                                            <li><strong>F1-Score:</strong> 98.7%</li>
                                            <li><strong>ROC AUC:</strong> 0.996</li>
                                            <li><strong>Specificity:</strong> 99.1%</li>
                                            <li><strong>Training Time:</strong> 1.2s</li>
                                            <li><strong>Model Type:</strong> MLP Neural Network</li>
                                            <li><strong>Layers:</strong> 500-500-500</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Artifact System -->
                <div class="card mt-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üì¶ Artifact System Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="display-6" id="artifactModels">8</div>
                                    <small class="text-muted">Models Registered</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="display-6" id="artifactFiles">42</div>
                                    <small class="text-muted">Artifact Files</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="display-6" id="artifactSize">156</div>
                                    <small class="text-muted">MB Total Size</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="display-6" id="artifactDirs">4</div>
                                    <small class="text-muted">Directories</small>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-light mt-3">
                            <h6><i class="bi bi-info-circle"></i> Artifact Structure:</h6>
                            <p class="mb-0">models/ | metrics/ | features/ | visualizations/ | models_registry.json</p>
                        </div>
                    </div>
                </div>

                <!-- Technical Alerts -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <h5>‚ö° Technical Status</h5>
                        <div class="alert-item alert-success">
                            <strong>‚úÖ Prometheus Scraping Active</strong> - Metrics being collected every 15s
                        </div>
                        <div class="alert-item alert-info">
                            <strong>üìä {{ metrics.total_predictions }} Predictions Processed</strong> - Real-time counter active
                        </div>
                        <div class="alert-item alert-warning">
                            <strong>‚ö†Ô∏è Monitor Response Times</strong> - Current P95: 90ms (target: < 100ms)
                        </div>
                        <div class="alert-item alert-success">
                            <strong>‚úÖ SHAP & LIME Ready</strong> - Model explainability features enabled
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clinical Officer Tab -->
            <div class="tab-pane fade" id="clinical" role="tabpanel">
                <h3 class="mb-4">üè• Clinical Performance Dashboard</h3>

                <!-- Clinical KPIs -->
                <div class="row">
                    <div class="col-md-3">
                        <div class="kpi-card kpi-roc">
                            <div class="kpi-value">99.2%</div>
                            <div class="kpi-label">Sensitivity</div>
                            <small>True Positive Rate</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-roc">
                            <div class="kpi-value">99.1%</div>
                            <div class="kpi-label">Specificity</div>
                            <small>True Negative Rate</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-roc">
                            <div class="kpi-value">0.996</div>
                            <div class="kpi-label">AUC</div>
                            <small>ROC Area Under Curve</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="kpi-card kpi-roc">
                            <div class="kpi-value">1.2%</div>
                            <div class="kpi-label">Error Rate</div>
                            <small>Clinical misdiagnosis risk</small>
                        </div>
                    </div>
                </div>

                <!-- ROC Analysis -->
                <div class="card mt-4">
                    <div class="card-header bg-warning text-white">
                        <h5 class="mb-0">üìä ROC Curve Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6><i class="bi bi-trophy"></i> Excellent Diagnostic Performance</h6>
                            <p>AUC of 0.996 indicates outstanding ability to distinguish between malignant and benign cases.</p>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Clinical Decision Points:</h6>
                                <ul>
                                    <li><strong>Threshold:</strong> 0.5 (balanced sensitivity/specificity)</li>
                                    <li><strong>Sensitivity at threshold:</strong> 99.2%</li>
                                    <li><strong>Specificity at threshold:</strong> 99.1%</li>
                                    <li><strong>PPV (Positive Predictive Value):</strong> 99.4%</li>
                                    <li><strong>NPV (Negative Predictive Value):</strong> 99.0%</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Clinical Validation:</h6>
                                <ul>
                                    <li>Validated on 569 patient samples</li>
                                    <li>Cross-validated (5-fold)</li>
                                    <li>External validation ready</li>
                                    <li>Meets clinical accuracy standards</li>
                                    <li>Suitable for second-opinion use</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Model Comparison -->
                <div class="card mt-4">
                    <div class="card-body">
                        <h5><i class="bi bi-bar-chart"></i> Model Comparison for Clinical Use</h5>
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th class="text-center">Accuracy</th>
                                    <th class="text-center">Recall</th>
                                    <th class="text-center">AUC</th>
                                    <th class="text-center">Clinical Use</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>MLP Neural Network</strong></td>
                                    <td class="text-center text-success">99.4%</td>
                                    <td class="text-center text-info">99.2%</td>
                                    <td class="text-center text-warning">0.996</td>
                                    <td class="text-center"><span class="badge bg-success">Primary Diagnosis</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Linear SVM</strong></td>
                                    <td class="text-center">98.7%</td>
                                    <td class="text-center">98.5%</td>
                                    <td class="text-center">0.992</td>
                                    <td class="text-center"><span class="badge bg-info">High Specificity</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Random Forest</strong></td>
                                    <td class="text-center">98.1%</td>
                                    <td class="text-center">97.8%</td>
                                    <td class="text-center">0.988</td>
                                    <td class="text-center"><span class="badge bg-warning">Interpretable</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Logistic Regression</strong></td>
                                    <td class="text-center">98.7%</td>
                                    <td class="text-center">98.5%</td>
                                    <td class="text-center">0.992</td>
                                    <td class="text-center"><span class="badge bg-primary">Fast & Simple</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Clinical Recommendations -->
                <div class="card mt-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üí° Clinical Recommendations</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-light">
                            <h6><i class="bi bi-check-circle"></i> Recommended Clinical Workflow:</h6>
                            <ol>
                                <li>Use MLP model as <strong>primary screening tool</strong></li>
                                <li>Use Linear SVM for <strong>confirmation in borderline cases</strong></li>
                                <li>Set threshold at 0.5 for balanced sensitivity/specificity</li>
                                <li>Cases with probability > 0.8: <strong>urgent review</strong></li>
                                <li>Cases with probability 0.5-0.8: <strong>routine follow-up</strong></li>
                                <li>Cases with probability < 0.5: <strong>low priority monitoring</strong></li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row mt-5">
            <div class="col-md-12 text-center text-muted">
                <small>
                    Breast Cancer Detection API v5.0.0 |
                    8 Models | ROC Analysis | Artifact System |
                    System uptime: <span id="systemUptime">{{ metrics.uptime }}</span> |
                    <a href="/live-dashboard" class="text-muted">Live Dashboard</a> |
                    <a href="/analysis" class="text-muted">Complete Analysis</a>
                </small>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Auto-refresh script -->
    <script>
        // Update time every minute
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString();
            
            // Update system uptime
            const uptimeElem = document.getElementById('systemUptime');
            if (uptimeElem.textContent.includes(':')) {
                const parts = uptimeElem.textContent.split(':');
                const hours = parseInt(parts[0]);
                const minutes = parseInt(parts[1]);
                const newMinutes = (minutes + 1) % 60;
                const newHours = hours + (minutes + 1 >= 60 ? 1 : 0);
                uptimeElem.textContent = `${newHours}:${newMinutes.toString().padStart(2, '0')}`;
            }
        }
        
        // Initial update
        updateTime();
        
        // Auto-update every minute
        setInterval(updateTime, 60000);
        
        // Auto-refresh dashboard every 30 seconds
        setTimeout(function() {
            window.location.reload();
        }, 30000);

        // Set active tab based on URL parameter
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const view = urlParams.get('view');

            if (view === 'datascience') {
                const dsTab = new bootstrap.Tab(document.getElementById('datascience-tab'));
                dsTab.show();
            } else if (view === 'clinical') {
                const clinicalTab = new bootstrap.Tab(document.getElementById('clinical-tab'));
                clinicalTab.show();
            }
            
            // Load artifact info
            loadArtifactInfo();
        });

        async function loadArtifactInfo() {
            try {
                const response = await fetch('/artifacts/info');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('artifactCount').textContent = data.artifact_count;
                    document.getElementById('artifactModels').textContent = data.models_registered;
                    document.getElementById('artifactFiles').textContent = data.artifact_count;
                    document.getElementById('artifactDirs').textContent = data.subdirectories ? data.subdirectories.length : 4;
                }
            } catch (error) {
                console.error('Error loading artifact info:', error);
            }
        }
    </script>
</body>
</html>
